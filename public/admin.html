<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - InvestKzangola</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo">ADM</div>
        <div class="brand-text">
          <div class="brand-title">Administração</div>
        </div>
      </div>
      <nav class="nav">
        <a href="admin.html" class="nav-link active">Depósitos</a>
      </nav>
    </div>
  </header>

  <main>
    <h2>Depósitos pendentes</h2>
    <div id="pendingList">Carregando...</div>
  </main>

  <script>
    (async function(){
      const API = window.API_BASE_URL || "http://localhost:3000";
      const token = localStorage.getItem("token");
      if (!token) { window.location.href="/login.html"; return;}
      const r = await fetch(API + "/api/admin/deposits", { headers: { Authorization: `Bearer ${token}` }});
      const el = document.getElementById("pendingList");
      if (!r.ok) { el.innerText = "Não autorizado ou erro"; return; }
      const j = await r.json();
      if (!j.deposits || !j.deposits.length) { el.innerText = "Sem depósitos pendentes"; return; }
      el.innerHTML = "";
      j.deposits.forEach(d => {
        const div = document.createElement("div");
        div.innerHTML = `<div class="card"><strong>${d.userPhone}</strong> - ${d.amount} Kz - <button onclick="aprovar('${d._id}')">Aprovar</button></div>`;
        el.appendChild(div);
      });
      window.aprovar = async function(id){ 
        const r = await fetch(API + "/api/admin/deposit/approve", { method:"POST", headers:{ "Content-Type":"application/json", Authorization:`Bearer ${token}` }, body: JSON.stringify({ depositId: id })});
        if (r.ok) { alert("Aprovado"); location.reload(); } else { alert("Erro"); }
      };
    })();
  </script>
</body>
</html>
